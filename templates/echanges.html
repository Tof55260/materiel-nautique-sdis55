<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Échanges</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<header class="topbar">
  <div class="brand">
    <img class="brand-logo big" src="{{ url_for('static', filename='images/logo_nautique.jpeg') }}">
    <div>
      <div class="brand-title">Échanges de matériel</div>
      <div class="brand-subtitle">
        {{ prenom }} {{ nom }} — {{ role }}
      </div>
    </div>
  </div>

  <div class="userchip">
    <a class="link" href="{{ url_for('logout') }}">Déconnexion</a>
  </div>
</header>

<nav class="tabs">
  <a class="tab" href="{{ url_for('accueil') }}">Accueil</a>
  <a class="tab active" href="{{ url_for('echanges') }}">Échanges</a>
  <a class="tab" href="{{ url_for('mon_compte') }}">Mon compte</a>
  {% if role == "Admin" %}
  <a class="tab" href="{{ url_for('inventaire') }}">Inventaire</a>

    <a class="tab" href="{{ url_for('admin_agents') }}">Administration</a>
  {% endif %}
</nav>

<main class="wrap">

<section class="card">
<h2>Nouvelle demande d’échange</h2>

<form method="POST" class="formgrid">
  <input name="materiel" placeholder="Matériel concerné" required>
  <input name="motif" placeholder="Motif de la demande" required>
  <button>Envoyer la demande</button>
</form>
</section>

<section class="card">
<h2>Historique des demandes</h2>

{% if echanges|length == 0 %}
<p class="muted">Aucune demande enregistrée.</p>
{% else %}

<table class="table">
<tr>
<th>Date</th>
<th>Agent</th>
<th>Matériel</th>
<th>Motif</th>
<th>Statut</th>
{% if role=="Admin" %}<th>Action</th>{% endif %}
</tr>

{% for e in echanges %}
<tr>
<td>{{ e.date }}</td>
<td>{{ e.agent }}</td>
<td>{{ e.materiel }}</td>
<td>{{ e.motif }}</td>

<td>
<span class="badge {{ e.statut|lower }}">
{{ e.statut }}
</span>
</td>

{% if role=="Admin" and e.statut=="En attente" %}
<td>
<a class="link success" href="/echanges/{{ e.id }}/valider">Valider</a>
<a class="link danger" href="/echanges/{{ e.id }}/refuser">Refuser</a>
</td>
{% endif %}
</tr>
{% endfor %}
</table>

{% endif %}
</section>

</main>

<footer class="footer">
Développé par <strong>Christophe BOUDOT</strong>
</footer>

</body>
</html>
