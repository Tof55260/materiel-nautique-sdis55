{% extends "base.html" %}
{% block content %}

<h2>Gestion des échanges</h2>

<table>

<tr>
<th>Date</th>
<th>Agent</th>
<th>Ancien matériel</th>
<th>Commentaire</th>
<th>Statut</th>
<th>Nouveau matériel</th>
<th>Action</th>
</tr>

{% for e in echanges %}
<tr>

<td>{{ e.date[:16] }}</td>
<td>{{ e.agent }}</td>
<td>{{ e.ancien_materiel }}</td>
<td>{{ e.commentaire }}</td>

<td>
{% if e.statut == "en_attente" %}
<span style="color:orange;font-weight:bold">En attente</span>
{% elif e.statut == "traite" %}
<span style="color:green;font-weight:bold">Traité</span>
{% else %}
{{ e.statut }}
{% endif %}
</td>

<td>

{% if e.statut == "en_attente" %}

<form method="POST" action="/admin/traiter_echange">

<input type="hidden" name="id" value="{{ e.id }}">

<select name="nouveau" required>

<option value="">— Choisir matériel —</option>

{% for s in stock %}
<option value="{{ s.numero_serie }}">
{{ s.nom }} — {{ s.numero_serie }}
</option>
{% endfor %}

</select>

</td>

<td>

<button style="background:#4caf50;color:white;padding:5px 10px">
✅ Traiter
</button>

</form>

{% else %}

—

{% endif %}

</td>

</tr>
{% endfor %}

</table>

{% endblock %}
