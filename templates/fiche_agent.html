<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Fiche agent</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<header class="topbar">
  <div class="brand">
    <img class="brand-logo big" src="{{ url_for('static', filename='images/logo_nautique.jpeg') }}">
    <div>
      <div class="brand-title">{{ agent.prenom }} {{ agent.nom }}</div>
      <div class="brand-subtitle">Fiche individuelle — Admin</div>
    </div>
  </div>
  <div class="userchip">
    <a class="link" href="{{ url_for('logout') }}">Déconnexion</a>
  </div>
</header>

<nav class="tabs">
  <a class="tab" href="{{ url_for('accueil') }}">Accueil</a>
  <a class="tab" href="{{ url_for('fiches_agents') }}">Retour liste</a>
</nav>

<main class="wrap">

<section class="card">
  <h2>Matériel affecté</h2>

  <table class="table">
    <tr>
      <th>Matériel</th>
      <th>Contrôle EPI</th>
      <th>Action</th>
    </tr>

    {% for m in materiels %}
    {% set lib = m.materiel or m.nom or m.designation or "—" %}
    <tr>
      <td>{{ lib }}</td>
      <td class="{{ m.epi }}">{{ m.controle or "" }}</td>
      <td>
        <form method="POST" action="/materiel/action" class="inline">
          <input type="hidden" name="id" value="{{ m.id }}">
          <input type="hidden" name="agent_login" value="{{ agent.login }}">
          <input type="hidden" name="agent_fullname" value="{{ agent_fullname }}">
          <input type="hidden" name="materiel" value="{{ lib }}">

          <select name="action">
            <option value="stock">Retour magasin</option>
            <option value="reforme">Réformer</option>
            <option value="echange">Échanger</option>
          </select>

          <select name="remplace">
            <option value="">-- remplaçant --</option>
            {% for x in magasin %}
              {% set xlib = x.nom or x.materiel or x.designation or "—" %}
              <option value="{{ xlib }}">{{ xlib }} (stock: {{ x.stock or 0 }})</option>
            {% endfor %}
          </select>

          <input type="date" name="controle">
          <button>Valider</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
</section>

<section class="card">
  <h2>Historique</h2>

  <table class="table">
    <tr><th>Date</th><th>Matériel</th><th>Action</th></tr>
    {% for h in hist %}
    <tr>
      <td>{{ h.date }}</td>
      <td>{{ h.materiel }}</td>
      <td>{{ h.action }}</td>
    </tr>
    {% endfor %}
  </table>
</section>

</main>

<footer class="footer">
  Développé par <strong>Christophe BOUDOT</strong>
</footer>

</body>
</html>
