@app.route("/ma-fiche")
def ma_fiche():

    if "login" not in session:
        return redirect("/")

    agent = {
        "nom": session.get("nom"),
        "prenom": session.get("prenom"),
        "login": session.get("login"),
        "role": session.get("role")
    }

    mats = supabase.table("materiels") \
        .select("*") \
        .eq("agent", session["login"]) \
        .execute().data

    hist = supabase.table("historique") \
        .select("*") \
        .eq("agent", session["login"]) \
        .order("date", desc=True) \
        .execute().data

    return render_template(
        "ma_fiche.html",
        agent=agent,
        materiels=mats,
        historique=hist,
        **session
    )
