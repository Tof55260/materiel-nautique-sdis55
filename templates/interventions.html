{% extends "base.html" %}
{% block content %}

<div class="interventions-header">
  <h2>Interventions</h2>
  <span class="badge-year">{{ selected_year }}</span>
</div>

<form method="GET" action="/interventions" style="margin-bottom:20px">
  <label>Ann√©e :</label>
  <select name="annee" onchange="this.form.submit()">
    {% for y in years %}
      <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
    {% endfor %}
  </select>
</form>

{% if can_edit %}
<h3>Ajouter une intervention</h3>

<form method="POST" action="/interventions?annee={{ selected_year }}" class="form" style="margin-bottom:30px">

  <input name="numero" placeholder="Num√©ro intervention" required>
  <input type="date" name="date" required>
  <input name="lieu" placeholder="Lieu" required>
  <input name="motif" placeholder="Motif" required>

  <div style="display:grid;gap:15px;grid-template-columns:1fr 1fr 1fr;margin-top:10px">

    <div>
      <label>CU</label>
      <select name="cu">
        <option value="">‚Äî</option>
        {% for a in cu_list %}
          <option value="{{ a.login }}">{{ a.prenom }} {{ a.nom }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label>Plongeurs</label>
      <select name="plongeurs" multiple size="6">
        {% for a in plongeurs_list %}
          <option value="{{ a.login }}">{{ a.prenom }} {{ a.nom }}</option>
        {% endfor %}
      </select>
      <small>Ctrl / Shift pour multi-s√©lection</small>
    </div>

    <div>
      <label>SAS</label>
      <select name="sas" multiple size="6">
        {% for a in sas_list %}
          <option value="{{ a.login }}">{{ a.prenom }} {{ a.nom }}</option>
        {% endfor %}
      </select>
      <small>Ctrl / Shift pour multi-s√©lection</small>
    </div>

  </div>

  <button style="margin-top:15px">Ajouter l‚Äôintervention</button>
</form>
{% endif %}

<hr>

{% for itv in interventions %}
<div class="intervention-card">

  <div class="intervention-top">
    <div class="intervention-num">Intervention {{ itv.numero }}</div>
    <div class="intervention-date">{{ itv.date }}</div>
  </div>

  <div class="intervention-body">
    <div class="intervention-lieu">üìç {{ itv.lieu }}</div>
    <div class="intervention-motif">{{ itv.motif }}</div>

    <div class="participants">

      {% if itv.cu %}
      <span class="role-badge role-cu">
        CU : {{ name_map.get(itv.cu, itv.cu) }}
      </span>
      {% endif %}

      {% for p in itv.plongeurs or [] %}
      <span class="role-badge role-plongeur">
        Plg : {{ name_map.get(p, p) }}
      </span>
      {% endfor %}

      {% for s in itv.sas or [] %}
      <span class="role-badge role-sas">
        SAS : {{ name_map.get(s, s) }}
      </span>
      {% endfor %}

    </div>

    {% if can_edit %}
    <div class="intervention-actions">
      <a href="/interventions/{{ itv.id }}/edit">‚úèÔ∏è Modifier</a>
    </div>
    {% endif %}

  </div>

</div>
{% else %}
<p style="text-align:center;color:#666;margin-top:40px">
Aucune intervention enregistr√©e pour {{ selected_year }}.
</p>
{% endfor %}

{% endblock %}
